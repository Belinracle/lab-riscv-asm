.data
N:
	.word 7
M:
	.word 2
matrix:
	.word 1, 1, 1, 0, 0, 0, 0
	.word 0, 1, 1, 0, 0, 0, 0
result:
	.word 0
	.word 0

.text

main:
	lw a2, N				#количество столбцов в регистре а2(аргумент функции)
	lw a3, M				#количество строк в регистре а3(аргумент функции)
	la a4, matrix			#адрес массива в регистре а4(аргумент функции)
	la a5, result			#адрес результата в регистре а5(аргумент функции)
	addi sp, sp, -16
	
#загружаем аргументы в стек для передачи подпрограмме

	sw a2, 0(sp)			#количество столбцов N 0(sp) 
	sw a3, 4(sp)			#количество строк М	4(sp)
	sw a4, 8(sp)			#адрес массива в 8(sp)
	sw a5, 12(sp)			#адрес результата в 12(sp)
	
	call process
	
	la a2, M
	la a3, result
	call print
	call exit

	print:
	lw t1, 0(a2)

	addi t2, x0, 0
	print_cycle:
	addi a0, x0, 1 # print_int ecall
	lw a1, 0(a3)
	ecall

	addi a0, x0, 11 # print_char ecall
	addi a1, x0, 32
	ecall

	addi t2, t2, 1
	addi a3, a3, 4
	blt t2, t1, print_cycle
	ret

	exit:
	addi a0, x0, 10
	ecall
	
process:
	lw t0, 0(sp) 			#N
	lw t1, 4(sp) 			#M
	lw t2, 8(sp) 			#загрузка адреса массива в t2

addi t3, x0, 0 				#номер обрабатываемой строки

init:		  				#инициализация перед обработкой строки
	addi t4, x0, 0			#счетчик единиц
	addi t5, x0, 0 			#номер элемента в строке
	
cycle:
	lw t6, 0(t2)			#загрузка текущего элемента матрицы в t6
	addi t2, t2, 4 			#инкремент указателя матрицы
	addi t5, t5, 1			#увеличение номера обрабатываемого элемента в строке
	blt x0, t6, one
zero:
	blt x0, t4, endrow		#если уже были единицы то заканчиваем обработку строки
	blt t5, t0, cycle		#если еще есть элементы то обрабатываем
	j endrow				#если нет элементов и не было единиц заканчиваем обработку строки
one:
	addi t4, t4, 1			#если единицы текуший элемент то увеличиваем счетчик единиц
	blt t5, t0, cycle		#проверяем есть ли еще элементы
endrow:
	lw t5, 12(sp)			#из стека достаем адрес массива результатов
	sw t4, 0(t5) 			#сохраняем количество единиц в результат
	addi t5, t5, 4			#увеличиваем указатель результата 
	sw t5, 12(sp)			#сохраняем обратно в стек
	addi t3, t3, 1			#увеличиваем номер текущей строки на 1
	blt t3, t1, init		#проверка есть ли еще строки
	ret